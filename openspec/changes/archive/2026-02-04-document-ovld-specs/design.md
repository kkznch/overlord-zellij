## 背景

Zellijターミナルマルチプレクサ上で複数のClaudeインスタンスを協調動作させる。ユーザー（深淵の意志）→ 魔王(Overlord) → 軍師(Strategist) → 兵団という階層で、抽象的な要望を具体的な実装タスクに落とし込む。

現状：Zellijは手動でセッション管理が必要。各ペインへのプロンプト設定も手作業。

## 目標 / 非目標

**目標:**
- 1コマンドで魔王軍セッションを起動・終了できる
- 各役職に適切な初期プロンプトを自動注入する
- ゾンビプロセスなしでクリーンな終了を保証する

**非目標:**
- Claude間の自動通信（手動コピペで対応）
- セッション状態の永続化
- 複数セッションの同時管理

## 設計判断

### 1. CLIフレームワーク: clap (derive)
Rustの標準的なCLIライブラリ。derive macroで宣言的にコマンド定義でき、ヘルプ自動生成。

### 2. タブベースのレイアウト
各役職を独立タブで分離。`go-to-tab-name`で確実にターゲットでき、ペイン直接指定の制約を回避。兵団のみ同一タブ内で横分割（相互確認しやすい）。

### 3. プロンプト注入: `zellij action write-chars`
Zellijの標準機能で外部からペインにテキスト送信。セッション名指定で非アタッチ状態からも操作可能。

### 4. 儀式ファイル形式: Markdown
人間が読み書きしやすく、複数行のプロンプトを自然に記述できる。

## リスク / トレードオフ

- **[ペイン特定の不安定さ]** → タブ名での移動とfocus-next-paneの組み合わせで対応
- **[プロンプト注入タイミング]** → 遅延（500ms〜1s）を入れてペイン準備完了を待つ
- **[Claude CLI依存]** → 各ペインにclaude cliがインストールされている前提
